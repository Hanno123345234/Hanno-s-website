<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Imposter – Truth or Dare</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="app">
      <section id="home" class="card active">
        <div class="top-tools">
          <a id="truthBackToModes" href="/" class="mini-link">← Back to modes</a>
          <div class="lang-inline">
            <label for="truthLangSelect">Language</label>
            <select id="truthLangSelect" aria-label="Select language">
              <option value="en">English</option>
            </select>
          </div>
        </div>

        <p id="connectionBadge" class="connection connection-offline">● Connecting…</p>
        <h1>Imposter – Truth or Dare</h1>
        <p class="subtitle">Create a room or join with code</p>

        <div class="account-box">
          <h3>Account</h3>
          <p id="savedNameText" class="subtitle">Not signed in yet</p>
          <label for="profileNameInput">Your name (saved)</label>
          <input id="profileNameInput" maxlength="24" placeholder="e.g. Hanno" />
          <button id="saveProfileBtn" class="primary">Sign in / Save name</button>
        </div>

        <div id="menuActions" class="stack hidden">
          <button id="createBtn" class="primary">Create room</button>
        </div>

        <div id="joinBox" class="join-box hidden">
          <label for="codeInput">Room code</label>
          <input id="codeInput" maxlength="5" placeholder="ABCDE" />
          <label for="pinInput">PIN (4 digits)</label>
          <input id="pinInput" maxlength="4" placeholder="1234" />
          <label class="check-row" for="spectatorToggle">
            <input id="spectatorToggle" type="checkbox" />
            <span>Join as spectator</span>
          </label>
          <button id="joinBtn">Join room</button>
        </div>

        <div class="recent-box">
          <h3>Recent players</h3>
          <div id="recentPlayers" class="recent-list"></div>
        </div>

        <details class="rules-box">
          <summary>Show rules</summary>
          <ol>
            <li>The host creates a lobby and everyone joins with a code.</li>
            <li>Joining requires room code + 4-digit PIN.</li>
            <li>Each player secretly gets Truth or Dare.</li>
            <li>One player is the imposter and gets a fake task.</li>
            <li>Everyone performs their task and tries to look normal.</li>
            <li>Then vote: who is the imposter?</li>
            <li>If correct, the group wins. Otherwise the imposter wins.</li>
          </ol>
        </details>

        <p id="errorBox" class="error"></p>
      </section>

      <section id="room" class="card">
        <div class="room-header">
          <button id="backBtn" class="back-btn">← Back</button>
          <h2>Room <span id="roomCode">-----</span></h2>
        </div>
        <div class="state-bar">
          <p id="stateText" class="subtitle">Waiting in lobby…</p>
          <p id="phaseTimer" class="timer hidden">00:00</p>
        </div>
        <p id="roomNotice" class="room-notice hidden"></p>

        <div class="score-board">
          <span class="score-chip">Group: <strong id="scoreGroup">0</strong></span>
          <span class="score-chip">Imposter: <strong id="scoreImposter">0</strong></span>
          <span id="modeBadgeRoom" class="score-chip">Mode: spicy</span>
        </div>

        <div id="inviteBox" class="invite-box hidden">
          <h3>Invite</h3>
          <p class="subtitle">Share code or link with friends</p>
          <div class="invite-actions">
            <button id="copyCodeBtn">Copy code</button>
            <button id="copyLinkBtn">Copy invite link</button>
          </div>
          <p class="subtitle">PIN: <strong id="pinDisplay">----</strong></p>
          <div id="qrWrap" class="qr-wrap">
            <div id="qrCode"></div>
          </div>
          <div>
            <h4>Quick re-invite</h4>
            <div id="recentInviteList" class="recent-list"></div>
          </div>
          <p id="inviteInfo" class="subtitle"></p>
        </div>

        <div id="adminBox" class="admin-box hidden">
          <h3>Host controls</h3>
          <label for="modeSelect">Content-Filter</label>
          <select id="modeSelect">
            <option value="family">Family</option>
            <option value="normal">Normal</option>
            <option value="spicy">Spicy</option>
          </select>
          <div class="prompt-editor">
            <input id="customTruthInput" maxlength="180" placeholder="Add custom truth" />
            <button id="addTruthBtn">Add truth</button>
            <input id="customDareInput" maxlength="180" placeholder="Add custom dare" />
            <button id="addDareBtn">Add dare</button>
          </div>
          <div class="invite-actions">
            <button id="toggleLockBtn">Lock lobby</button>
            <button id="abortRoundBtn">Abort round</button>
          </div>
          <div class="audit-box">
            <h4>Audit-Log</h4>
            <ul id="auditList"></ul>
          </div>
          <div class="stats-box">
            <h4>Round stats</h4>
            <ul id="statsList"></ul>
          </div>
        </div>

        <div class="player-list-wrap">
          <h3>Players</h3>
          <div class="rename-row">
            <input id="renameInput" maxlength="24" placeholder="New name (optional)" />
            <button id="renameBtn">Change name</button>
          </div>
          <ul id="playerList" class="player-list"></ul>
        </div>

        <div class="player-list-wrap">
          <h3>Spectators</h3>
          <ul id="spectatorList" class="player-list"></ul>
        </div>

        <div id="hostControls" class="stack hidden">
          <button id="startRoundBtn" class="primary">Start round</button>
          <button id="startVoteBtn">Start voting</button>
          <button id="newRoundBtn">New round</button>
        </div>

        <div id="assignmentBox" class="assignment hidden">
          <h3>Your secret task</h3>
          <p id="modeBadge" class="badge"></p>
          <p id="roleBadge" class="badge role"></p>
          <p id="promptText" class="prompt"></p>
        </div>

        <div id="voteBox" class="hidden">
          <h3>Vote: Who is the imposter?</h3>
          <div id="voteButtons" class="vote-buttons"></div>
          <p id="voteInfo" class="subtitle"></p>
        </div>

        <div id="resultBox" class="hidden result"></div>
        <button id="resultNewRoundBtn" class="primary hidden">Start new round</button>
      </section>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      (function setupTruthLanguageMenu() {
        const key = "app_lang_v1";
        const select = document.getElementById("truthLangSelect");
        const backLink = document.getElementById("truthBackToModes");
        if (!select || !backLink) {
          return;
        }

        function getLang() {
          return "en";
        }

        function applyLang(lang) {
          window.localStorage.setItem(key, lang);
          document.documentElement.lang = lang;
          select.value = lang;
          backLink.href = `/?lang=${encodeURIComponent(lang)}`;
          const url = new URL(window.location.href);
          url.searchParams.set("lang", lang);
          window.history.replaceState(null, "", url.toString());
        }

        select.addEventListener("change", () => {
          applyLang("en");
        });

        applyLang(getLang());
      })();
    </script>
    <script src="app.js"></script>
  </body>
  </html>
